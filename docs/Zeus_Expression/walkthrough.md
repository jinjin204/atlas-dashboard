# 実装完了報告: Zeusロジック強化とマスタデータ動的読み込み

## 変更内容の概要
`master_loader.py` を修正し、イベントマスタから動的に対象シートを特定してデータを読み込むようにしました。また `zeus_chat.py` を更新し、履歴データに基づいた進捗分析と予言ロジックを実装しました。

### 1. マスタ読み込みの動的化 (`master_loader.py`)
- **動的シート特定**: `イベントマスタ` シートを参照し、`表示フラグ` が設定されているシートを自動で読み込み対象とします。
- **データ抽出**: 対象シートの **F列（目標在庫）** と **G列（在庫数）** を読み込み、商品マスタ情報（`production_master.json`）に統合します。
- **履歴初期化**: `data/history_summary.json` が存在しない場合、初回のスキャン結果を初期データ（`type: "initial"`）として保存します。

### 2. Zeusの知能強化 (`zeus_chat.py`)
- **3つの指標計算**:
    - **【残量】**: 目標総数 - 現在在庫総数
    - **【実力】**: 履歴データとの差分から算出した「日次生産ペース」
    - **【予言】**: 2026-05-05 までに現在のペースで完了するか判定
- **プロンプトの最適化**:
    - ユーザー名を「yjing」に固定。
    - 回答フォーマットを「現状・予測・次の一手」の3点に絞り、極めて簡潔にしました。
    - Windows環境での文字コードエラー（cp932）に対応する安全な出力処理を追加。

## 検証結果
検証スクリプト `tests/verify_zeus_logic.py` を作成し、以下の項目を確認済みです。

1. **マスタ読み込み**: ダミーのExcelファイルから正しくターゲット数量とイベント在庫が読み込まれること。
2. **履歴保存**: `history_summary.json` が生成され、正しい構造で保存されること。
3. **Zeusロジック**:
    - 履歴データから正しい生産ペース（実力）が算出されること。
    - 期限（2026-05-05）に対する予言判定がロジック通り（間に合う/間に合わない）に行われること。
    - システムプロンプトに指定のキーワード（yjing, 現状, 予測, 次の一手）が含まれていること。

> [!NOTE]
> 初回実行時は「履歴データ」が1つしかないため、Zeusはペース計算ができず「データ不足」と回答しますが、日を改めて2回目のデータがロードされると「実力」と「予言」が表示されるようになります。

## 次のステップ
アプリを起動し、実際の `メニュー.xlsx` を読み込ませて動作確認を行ってください。Zeusに「現状はどう？」と話しかけると、新しいフォーマットで回答されます。
