# Implementation Plan - Multi-Event Target Aggregation

## 概要 (Overview)
「イベントマスタ」シートを司令塔とし、そこで `アクティブフラグ=TRUE` となっている複数のイベントシートを読み込み、目標数を合算してZeusに認識させます。
現在の「プルダウンで1つ選ぶ」方式から、「マスタの設定に従って自動的に全軍（全アクティブイベント）を指揮する」方式へ変更します。

## 提案内容 (Proposal)

### ロジック変更 (Logic Change)
1.  **司令塔の読み込み**: まず「イベントマスタ」シートを読み込む。
2.  **ターゲット特定**: `アクティブフラグ == TRUE` の行から `対象シート` 名のリストを作成する（例: `['クリマ2605', 'デザフェス58']`）。
3.  **合算 (Aggregation)**:
    - リスト内の各シートをループで読み込む。
    - 各商品の `target_quantity` を足し合わせる（例: クリマ30個 + デザフェス20個 = 合計50個）。
    - `event_data` には、各イベントごとの詳細（納期など）をリスト形式で保持する。

### 変更の規模とリスク (Scale & Risk)

| 項目 | 評価 | 詳細 |
| :--- | :--- | :--- |
| **変更の重さ** | 🟡 中程度 | ロジックの根本（単一シート→複数シートループ）が変わるため、数行の修正では済みませんが、大規模リファクタリングではありません。 |
| **処理の重さ** | 🟢 軽い | Excelシートの読み込み回数は増えますが、数枚程度なら誤差（数ミリ秒〜数百ミリ秒）の範囲です。 |
| **デバッグ** | 🟢 可能 | 裏でPythonスクリプトを走らせ、合算結果が正しいか（30+20=50になっているか）をログ出力して確認できます。 |

### デバッグ方法 (Debug Strategy)
- `verify_aggregation.py` というスクリプトを作成・実行します。
- このスクリプトは、アプリを起動せずにマスタデータとイベントマスタを読み込み、「どのシートがアクティブで、合計いくつになったか」をコンソールに表示します。
- これにより、アプリ画面を見なくても計算が正しいかを100%保証できます。

## 実行計画
承認をいただければ、以下の順で進めます。
1. `logic/master_loader.py`: `merge_event_targets` を `merge_all_active_events` に改修。
2. `verify_aggregation.py`: 合算ロジックの検証スクリプト作成・実行。
3. `app.py` & `zeus_chat.py`: 合算データの受け渡しと表示。
